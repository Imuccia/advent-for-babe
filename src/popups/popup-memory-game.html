<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Festive Memory Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
<div id="popup-memory-game" class="popup">
  <!-- Title and subtitle moved outside the glass container, centered above -->
  <div class="memory-header-outer">
    <h2 class="memory-title">üß† BONUS: Memory Game !!! üß†</h2>
    <p class="memory-desc">‚ú® Last bit of brainpower required ‚ú®<br><span class="memory-emoji">üíö</span></p>
  </div>
  <div class="popup-content glass" style="position:relative; margin: 0 auto;">
    <span class="snowflake snowflake-tl">‚ùÑÔ∏è</span>
    <span class="snowflake snowflake-tr">‚ùÑÔ∏è</span>
    <span class="snowflake snowflake-bl">‚ùÑÔ∏è</span>
    <span class="snowflake snowflake-br">‚ùÑÔ∏è</span>
    <div id="memory-game-board" class="memory-board"></div>
    <div id="memory-win" class="memory-win hide">
      <div class="win-content">
        <span class="bravix">BUON NATALEEEEE</span>
        <span class="bravix">(ily)</span>
      </div>
    </div>
    <!-- Debug button removed -->
  </div>
</div>

<style>
/* Festive transparent background image */
.popup {
  display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
  background: linear-gradient(135deg, #b2f7efcc 0%, #f7d6e0cc 100%), url('https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1200&q=80');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  justify-content: center; align-items: center; z-index: 1000;
  animation: fadeInBg 0.7s;
  flex-direction: column;
}
@keyframes fadeInBg { from { opacity: 0; } to { opacity: 1; } }

/* Center the header above the glass container */
.memory-header-outer {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  margin-bottom: 0.5em;
  /* margin-top: 2.5em; */
  z-index: 10;
  pointer-events: none;
  user-select: none;
}
.memory-title {
  font-size: 2.4em;
  color: #b80000;
  margin-bottom: 0em;
  line-height: 1.05;
  letter-spacing: 1px;
  text-shadow: 0 2px 8px #fff7, 0 0 2px #b80000;
  text-align: center;
  width: 100%;
}
.memory-desc {
  color: #4e5d6c;
  font-size: 1.15em;
  margin-bottom: 0em;
  line-height: 1.2;
  text-align: center;
  width: 100%;
}
.memory-emoji { font-size: 1.7em; }

.glass {
  background: rgba(255,255,255,0.7);
  box-shadow: 0 8px 32px 0 rgba(31,38,135,0.18);
  backdrop-filter: blur(10px);
  border-radius: 32px;
  padding: 3.5em 2.5em 2.5em 2.5em;
  border: 2px solid rgba(255,255,255,0.25);
  width: 900px;
  max-width: 98vw;
  position: relative;
  margin: 2.5em 0 2em 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: visible;
}
body, .memory-title, .memory-desc, .memory-btn {
  font-family: 'Nunito', 'Quicksand', 'Segoe UI', Arial, sans-serif;
}
/* Festive board and card size */
.memory-board {
  display: grid;
  grid-template-columns: repeat(4, 150px);
  grid-auto-rows: 150px;
  gap: 36px;
  justify-content: center;
  margin: 1em 0 1em 0;
  position: relative;
  overflow: visible;
}
.snowflake {
  position: absolute;
  font-size: 2.2em;
  z-index: 2;
  pointer-events: none;
  user-select: none;
  opacity: 0.85;
  text-shadow: 0 2px 8px #fff, 0 0 8px #b2f7ef;
}
.snowflake-tl { left: 0; top: 0; }
.snowflake-tr { right: 0; top: 0; }
.snowflake-bl { left: 0; bottom: 0; }
.snowflake-br { right: 0; bottom: 0; }
.memory-card-inner {
  width: 100%; height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.5s cubic-bezier(.4,2,.6,1);
}
.memory-card-inner.flipped, .memory-card-inner.matched {
  transform: rotateY(180deg);
}
.memory-card-front, .memory-card-back {
  position: absolute; width: 100%; height: 100%;
  backface-visibility: hidden;
  border-radius: 24px;
  display: flex; align-items: center; justify-content: center;
  top: 0; left: 0;
}
/* Festive card faces */
.memory-card-front {
  background: linear-gradient(135deg, #b80000 0%, #fffbe6 100%);
  font-size: 3em;
  color: #fff;
  font-family: inherit;
  font-weight: bold;
  letter-spacing: 2px;
  display: flex; align-items: center; justify-content: center;
  position: relative;
  /* Optionally add a festive border or shadow */
  box-shadow: 0 0 8px #b8000033;
}
/* Remove the tree emoji, show a question mark instead */
.memory-card-front::after {
  content: '?';
  font-size: 1.5em;
  color: #fff;
  opacity: 0.85;
  position: static;
}
/* Fix image centering and visibility */
.memory-card-back {
  background: #fff;
  transform: rotateY(180deg);
  box-shadow: 0 2px 8px #b8000022;
  display: flex; align-items: center; justify-content: center;
  height: 100%;
}
.memory-card img {
  width: 150px; height: 150px; user-select: none;
  filter: drop-shadow(0 2px 8px #b8000033);
  display: block;
  margin: 0 auto;
}
/* Festive matched effect */
.memory-card.matched {
  animation: popMatch 0.5s;
  border: 3.5px solid #1bbf00;
  box-shadow: 0 0 0 6px #fff7 inset, 0 0 16px #1bbf0033;
}
@keyframes popMatch {
  0% { transform: scale(1); }
  60% { transform: scale(1.18) rotate(-3deg); }
  100% { transform: scale(1); }
}
.memory-btn {
  background: linear-gradient(90deg, #1bbf00 0%, #ffe5ec 100%);
  color: #b80000;
  border: none;
  border-radius: 22px;
  padding: 0.9em 2.7em;
  font-size: 1.18em;
  font-family: inherit;
  margin-top: 1.5em;
  cursor: pointer;
  box-shadow: 0 2px 12px #b8000022;
  transition: background 0.2s, transform 0.2s;
}
.memory-btn:hover { background: linear-gradient(90deg, #ffe5ec 0%, #1bbf00 100%); transform: scale(1.07); }
/* Festive win overlay */
.memory-win {
  position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255,255,255,0.97);
  display: flex; align-items: center; justify-content: center;
  z-index: 10;
  animation: fadeInWin 0.7s;
  border-radius: 24px;
  box-shadow: 0 0 0 8px #ffe5ec inset;
}
.memory-win.hide { display: none; }
.win-content { text-align: center; }
.bravix {
  font-size: 4em;
  color: #b80000;
  font-family: 'Quicksand', 'Nunito', Arial, sans-serif;
  font-weight: bold;
  letter-spacing: 0.1em;
  text-shadow: 0 4px 24px #fff, 0 2px 8px #b8000033;
  display: block;
  margin: 0.5em 0;
  animation: bravixPop 1s cubic-bezier(.4,2,.6,1), bravixFestive 2.5s linear infinite;
}
@keyframes bravixFestive {
  0%   { color: #b80000; transform: scale(0.7) rotate(-2deg);}
  20%  { color: #1bbf00; transform: scale(1.15) rotate(2deg);}
  40%  { color: #f7d600; transform: scale(1.05) rotate(-2deg);}
  60%  { color: #b80000; transform: scale(1.18) rotate(3deg);}
  80%  { color: #1bbf00; transform: scale(1.08) rotate(-3deg);}
  100% { color: #b80000; transform: scale(1) rotate(0deg);}
}
@keyframes bravixPop {
  0% { transform: scale(0.7); opacity: 0; }
  60% { transform: scale(1.15); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}
@keyframes fadeInWin { from { opacity: 0; } to { opacity: 1; } }

</style>

<script>
// Set this to true to show the debug win button
const DEBUG_MODE = true;

// Debug button logic removed

// Memory Game Logic - Festive Version
const memoryImages = [
  'N_1', 'N_1',
  'N_2', 'N_2',
  'N_3', 'N_3',
  'N_4', 'N_4',
  'N_5', 'N_5',
  'N_6', 'N_6'
];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function createMemoryBoard() {
  const board = document.getElementById('memory-game-board');
  // Remove all except snowflakes
  board.querySelectorAll('.memory-card').forEach(card => card.remove());
  // Cards
  const shuffled = shuffle([...memoryImages]);
  shuffled.forEach((img, idx) => {
    const card = document.createElement('div');
    card.className = 'memory-card';
    card.dataset.image = img;
    card.innerHTML = `
      <div class="memory-card-inner">
        <div class="memory-card-front"></div>
        <div class="memory-card-back"><img src="../assets/images/memory/${img}.png" alt="${img}"></div>
      </div>
    `;
    card.addEventListener('click', onCardClick);
    board.appendChild(card);
  });
  // Hide win overlay if present
  document.getElementById('memory-win').classList.add('hide');
  // Reset state
  firstCard = null;
  secondCard = null;
  lockBoard = false;
  matches = 0;
}

let firstCard = null;
let secondCard = null;
let lockBoard = false;
let matches = 0;

function onCardClick(e) {
  const card = e.currentTarget;
  if (lockBoard || card.classList.contains('flipped') || card.classList.contains('matched')) return;
  card.classList.add('flipped');
  const inner = card.querySelector('.memory-card-inner');
  if (inner) inner.classList.add('flipped');
  if (!firstCard) {
    firstCard = card;
    return;
  }
  secondCard = card;
  lockBoard = true;
  if (firstCard.dataset.image === secondCard.dataset.image) {
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');
    const inner1 = firstCard.querySelector('.memory-card-inner');
    const inner2 = secondCard.querySelector('.memory-card-inner');
    if (inner1) inner1.classList.add('matched');
    if (inner2) inner2.classList.add('matched');
    matches += 1;
    setTimeout(() => {
      resetTurn();
      if (matches === memoryImages.length / 2) {
        showWin();
      }
    }, 600);
  } else {
    setTimeout(() => {
      firstCard.classList.remove('flipped');
      secondCard.classList.remove('flipped');
      const inner1 = firstCard.querySelector('.memory-card-inner');
      const inner2 = secondCard.querySelector('.memory-card-inner');
      if (inner1) inner1.classList.remove('flipped');
      if (inner2) inner2.classList.remove('flipped');
      resetTurn();
    }, 1100);
  }
}

function resetTurn() {
  [firstCard, secondCard] = [null, null];
  lockBoard = false;
}

function showWin() {
  document.getElementById('memory-win').classList.remove('hide');
}

// To show the popup and start the game:
document.getElementById('popup-memory-game').style.display = 'flex';
createMemoryBoard();

// Debug reset button logic
if (DEBUG_MODE) {
  const debugBtn = document.getElementById('debug-reset-memory');
  debugBtn.style.display = 'block';
  debugBtn.onclick = () => {
    showWin();
  };
}
</script>
</body>
</html>